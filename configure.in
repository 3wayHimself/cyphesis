dnl
dnl $Log: configure.in,v $
dnl Revision 1.4  2000-08-30 05:13:54  karsten
dnl small changes to configure.in so that "--with-atlas=" option works
dnl
dnl Revision 1.3  2000/08/21 11:31:18  alriddoch
dnl Can now connect, login or create account, and create a character, which is
dnl then added to the world. Socket code has been tweaked so it now handles
dnl client disconnection a little better.
dnl
dnl Al
dnl
dnl Revision 1.2  2000/08/19 16:42:18  alriddoch
dnl Server now allows client to create account, login, and attempt to create a
dnl character. Early stage of operation routing seems to be working.
dnl
dnl Al
dnl
dnl Revision 1.1  2000/08/13 20:36:18  alriddoch
dnl Initial check of work in progress converting cyphesis python code over to
dnl C++. Don't do anything to this code until I have finished moving the rest
dnl of the code into place.
dnl
dnl Al
dnl
dnl Revision 1.6  2000/05/05 17:34:14  laurel
dnl Gatherer is now a Command::Module, so we can chain gatherers.
dnl
dnl Revision 1.5  2000/03/16 19:52:38  laurel
dnl let's see if it "compiles" now.
dnl
dnl Revision 1.4  2000/03/14 04:09:57  laurel
dnl Fixed Atlas-C++ configure check so it works now.
dnl Does Atlas-C++ come with a configure check?  If not, should it?
dnl Thanks to ajr@ecs.soton.ac.uk
dnl
dnl Revision 1.3  2000/02/21 23:02:56  dert
dnl Added --with-atlas=/some/directory to autoconf.
dnl We are currently only checking for AtlasDebug.
dnl Hopefully we can use CVS-Log syntax in m4 files.
dnl
dnl

dnl Initialise autoconf

AC_INIT()

dnl Initialise automake

AM_INIT_AUTOMAKE("cyphesis", "0.0.0")

dnl Need libtool

AM_PROG_LIBTOOL
AC_PROG_LIBTOOL

dnl Test for C++ compiler

AC_PROG_CXX

CXXFLAGS='-Wall -g'

dnl Test for WorldForge Atlas Libraries

AC_LANG_CPLUSPLUS
AC_REQUIRE_CPP

AC_ARG_ENABLE(debug,[  --enable-debug           creates debugging code [default=no]],
[ 
   if test $enableval = "no"; then 
                ac_use_debug_code="no"  
   else 
                ac_use_debug_code="yes"
   fi
], [ac_use_debug_code="no"])



AC_CACHE_CHECK(for location of Atlas, cyphesis_cv_libatlas,
[
	cyphesis_cv_libatlas=/usr/local
	AC_ARG_WITH(atlas,
	[  --with-atlas=DIR           libAtlas is installed in ],
	[
		if test $withval != yes; then
			cyphesis_cv_libatlas=$withval
		fi
	])
])
dnl for some reason this only works if outside AC_CACHE_CHECK(..)
dnl (probably the check is only run if there is no config.cache file)
ATLAS_CXXFLAGS="-I${cyphesis_cv_libatlas}/include"
ATLAS_LDFLAGS="-L${cyphesis_cv_libatlas}/lib"


AC_CACHE_VAL(cyphesis_cv_atlas_headers,
[
	atlash="$atlash Atlas/Bridge.h"
dnl	atlash="$atlash Atlas/Net/Stream.h"
	atlash="$atlash Atlas/Message/Object.h"
dnl	atlash="$atlash Atlas/Objects/Decoder.h"
    AC_CHECK_HEADERS(`echo $atlash`, [],
	[
		AC_MSG_ERROR(Couldn't find working Atlas headers.)
	])
])

AC_CACHE_VAL(cyphesis_cv_atlas_libraries,
[
	AC_CHECK_LIB(AtlasDebug, main,
    [
	LIBS="$LIBS -L/home/ajr/atlas-install/lib"
        LIBS="$LIBS -lAtlas"
        LIBS="$LIBS -lAtlasCodecs"
        LIBS="$LIBS -lAtlasMessage"
        LIBS="$LIBS -lAtlasNet"
    ],
	[
		AC_MSG_ERROR(Couldn't find working AtlasDebug libraries.);
	])
])


CXXFLAGS="$CXXFLAGS $ATLAS_CXXFLAGS"
LDFLAGS="$LDFLAGS $ATLAS_LDFLAGS"

dnl Generate files
AC_OUTPUT([
	Makefile
	physics/Makefile
	common/Makefile
	modules/Makefile
	rulesets/Makefile
	server/Makefile
	client/Makefile
])
